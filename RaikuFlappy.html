<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Raiku Flappy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<style>
  body {
    margin:0;
    background:#000204;
    overflow:hidden;
    font-family:Arial,Helvetica,sans-serif;
    touch-action:none;
    color:#FDFDFF;
  }
  canvas { display:block; }
  #ui {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    pointer-events:none;
    text-align:center;
  }
  #header {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 38px;
    font-weight: bold;
    color: #C0FF38;
    text-shadow: 0 0 20px #C0FF38;
    pointer-events: none;
    z-index: 10;
  }
  #header img {
    height: 2cm;
    width: 5cm;
  }
  #score {
    font-size:80px;
    font-weight:bold;
    margin-top:90px;
    text-shadow:0 0 20px #FDFDFF;
  }
  #start {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    font-size:40px;
    color:#C0FF38;
    text-shadow:0 0 15px #C0FF38;
    pointer-events:all;
    cursor:pointer;
  }
  #gameover {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    font-size:36px;
    color:#FDFDFF;
    text-shadow:0 0 15px #C0FF38;
    display:none;
    pointer-events:all;
  }
  #footer {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 22px;
    color: #C0FF38;
    text-shadow: 0 0 12px #C0FF38;
    opacity: 0.9;
    pointer-events: none;
    z-index: 5;
  }

  /* ── Game control buttons ── */
  .game-btn {
    position: absolute;
    top: 15px;
    font-size: 24px;
    color: #C0FF38;
    background: rgba(0,0,0,0.5);
    padding: 10px 18px;
    border-radius: 10px;
    border: 2px solid #C0FF38;
    cursor: pointer;
    pointer-events: all;
    text-shadow: 0 0 10px #C0FF38;
    z-index: 15;
    transition: all 0.15s ease;
    text-decoration: none;
    display: inline-block;
  }

  .game-btn:hover {
    background: rgba(192,255,56,0.15);
    box-shadow: 0 0 20px #C0FF38;
  }

  #restart-btn {
    right: 15px;
    display: none;
  }

  #menu-btn {
    right: 15px;
    top: 70px;           /* below Restart button */
    display: none;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>

<!-- Background music -->
<audio id="bgm" loop preload="auto">
  <source src="bodym.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<div id="ui">
  <div id="header">
    <img src="logo.png" alt="Raiku Logo">
  </div>

  <div id="score">0</div>

  <!-- Added buttons -->
  <button id="restart-btn" class="game-btn">Restart</button>
  <a id="menu-btn" class="game-btn" href="index.html">Menu</a>

  <div id="start">
    Tap / Click to Start
    <br><small>Best: <span id="bestStart">0</span></small>
  </div>

  <div id="gameover">
    Game Over<br/>
    <span style="font-size:24px;">Score: <span id="final">0</span></span><br/><br/>
    Tap to Play Again
  </div>

  <div id="footer">Raiku  — Solana, but guaranteed.</div>
</div>

<script>
// ────────────────────────────────────────────────
const canvas = document.getElementById('c');
const ctx    = canvas.getContext('2d');
const scoreEl     = document.getElementById('score');
const startEl     = document.getElementById('start');
const gameoverEl  = document.getElementById('gameover');
const finalEl     = document.getElementById('final');
const bestStartEl = document.getElementById('bestStart');
const restartBtn  = document.getElementById('restart-btn');
const menuBtn     = document.getElementById('menu-btn');
const bgm         = document.getElementById('bgm');

let W, H;
function resize() {
  W = canvas.width  = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// ──────────────────────────────────────────────── Brand colors
const BLACK = '#000204';
const WHITE = '#FDFDFF';
const NEON  = '#C0FF38';

// ──────────────────────────────────────────────── Game state
let bird = {
  x: 160,
  y: H/2,
  vy: 0,
  angle: 0,
  gif: new Image()
};
bird.gif.src = "dragon.png";

let pipes = [];
let score = 0;
let highScore = parseInt(localStorage.getItem('raikuFlappyHS')) || 0;
let gameRunning = false;

// Base values
let baseGravity   = 0.22;
let baseFlapPower = -5.0;
let basePipeSpeed = 3.5;
let pipeGap       = 180;
let pipeWidth     = 80;
let nextPipeDist  = 280;

let gravity   = baseGravity;
let flapPower = baseFlapPower;
let pipeSpeed = basePipeSpeed;

// ──────────────────────────────────────────────── Input
function flap() {
  if (!gameRunning) {
    startGame();
    return;
  }
  bird.vy = flapPower;
}
window.addEventListener('click', flap);
window.addEventListener('touchstart', e => { e.preventDefault(); flap(); });
window.addEventListener('keydown', e => { if (e.code === 'Space') { e.preventDefault(); flap(); } });

// ──────────────────────────────────────────────── Pipe generator
function addPipe() {
  const topHeight = 80 + Math.random() * (H - pipeGap - 160);
  pipes.push({
    x: W + pipeWidth,
    top: topHeight,
    scored: false
  });
}

// ──────────────────────────────────────────────── Game loop
function update() {
  if (!gameRunning) return;

  const difficulty = 1 + (score * 0.035);
  gravity   = baseGravity   * difficulty;
  flapPower = baseFlapPower * Math.min(difficulty, 1.6);
  pipeSpeed = basePipeSpeed * difficulty;

  bird.vy += gravity;
  bird.y += bird.vy;
  bird.angle = Math.min(Math.max(bird.vy * 0.07, -0.8), 1.2);

  if (bird.y + 25 > H - 20 || bird.y - 25 < 20) {
    endGame();
  }

  pipes.forEach(p => {
    p.x -= pipeSpeed;

    if (!p.scored && p.x + pipeWidth < bird.x) {
      p.scored = true;
      score++;
      scoreEl.textContent = score;
    }

    const inX = bird.x + 25 > p.x && bird.x - 25 < p.x + pipeWidth;
    const hitTop    = bird.y - 25 < p.top;
    const hitBottom = bird.y + 25 > p.top + pipeGap;
    if (inX && (hitTop || hitBottom)) {
      endGame();
    }
  });

  pipes = pipes.filter(p => p.x > -pipeWidth);

  if (pipes.length === 0 || pipes[pipes.length-1].x < W - nextPipeDist) {
    addPipe();
  }
}

function draw() {
  const grad = ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0, '#0a0f14');
  grad.addColorStop(1, BLACK);
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,W,H);

  ctx.shadowColor = NEON;
  ctx.shadowBlur = 20;
  ctx.fillStyle = NEON;
  pipes.forEach(p => {
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.top + pipeGap, pipeWidth, H - (p.top + pipeGap));
  });
  ctx.shadowBlur = 0;

  ctx.fillStyle = 'rgba(253,253,255,0.08)';
  ctx.fillRect(0, H-20, W, 20);

  if (bird.gif.complete) {
    ctx.save();
    ctx.translate(bird.x, bird.y);
    ctx.rotate(bird.angle);

    ctx.shadowColor = NEON;
    ctx.shadowBlur = 30;
    ctx.beginPath();
    ctx.arc(0, 0, 30, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(192,255,56,0.35)';
    ctx.fill();
    ctx.shadowBlur = 0;

    const size = 60;
    ctx.drawImage(bird.gif, -size/2, -size/2, size, size);

    ctx.restore();
  } else {
    ctx.fillStyle = WHITE;
    ctx.beginPath();
    ctx.arc(bird.x, bird.y, 18, 0, Math.PI*2);
    ctx.fill();
  }
}

function render() {
  update();
  draw();
  requestAnimationFrame(render);
}

function startGame() {
  if (gameRunning) return;
  gameRunning = true;
  bird.y = H/2;
  bird.vy = flapPower;
  bird.angle = 0;
  pipes = [];
  score = 0;
  scoreEl.textContent = '0';
  startEl.style.display = 'none';
  gameoverEl.style.display = 'none';
  restartBtn.style.display = 'block';
  menuBtn.style.display = 'block';

  bgm.currentTime = 0;
  bgm.play().catch(e => console.log("Autoplay prevented:", e));

  addPipe();
}

function endGame() {
  gameRunning = false;
  bgm.pause();

  if (score > highScore) {
    highScore = score;
    localStorage.setItem('raikuFlappyHS', highScore);
  }
  finalEl.textContent = score;
  gameoverEl.innerHTML = `Game Over<br/>
    <span style="font-size:24px;">Score: <span id="final">${score}</span></span><br/><br/>
    Tap to Play Again<br><small>Best: ${highScore}</small>`;
  gameoverEl.style.display = 'block';

  restartBtn.style.display = 'none';
  menuBtn.style.display = 'none';
}

// ──────────────────────────────────────────────── Restart button logic
restartBtn.addEventListener('click', startGame);

// menuBtn is <a href="menu.html"> → no JS needed

// ──────────────────────────────────────────────── Kick off
bestStartEl.textContent = highScore;
render();
</script>
</body>
</html>