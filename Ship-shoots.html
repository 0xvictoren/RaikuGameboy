<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Raiku Space Shooter</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<style>
  body { 
    margin:0; 
    background:#000204; 
    overflow:hidden; 
    font-family:Arial,Helvetica,sans-serif; 
    touch-action:none; 
  }
  canvas { display:block; }
  
  #ui { 
    position:absolute; 
    inset: 0;
    pointer-events:none; 
    color:#FDFDFF; 
    text-align:center; 
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  #score { 
    font-size: min(80px, 18vw); 
    font-weight:bold; 
    margin-top: clamp(20px, 8vh, 40px); 
    text-shadow:0 0 20px #C0FF38; 
  }
  
  #wave { 
    font-size: min(32px, 7vw); 
    margin-top:10px; 
    text-shadow:0 0 10px #C0FF38; 
  }
  
  #start { 
    position:absolute; 
    top:50%; 
    left:50%; 
    transform:translate(-50%,-50%); 
    font-size: min(40px, 9vw); 
    color:#C0FF38; 
    text-shadow:0 0 15px #C0FF38; 
    pointer-events:all; 
    cursor:pointer;
    line-height: 1.4;
    padding: 0 20px;
  }
  
  #gameover { 
    position:absolute; 
    top:50%; 
    left:50%; 
    transform:translate(-50%,-50%); 
    font-size: min(36px, 8vw); 
    color:#C0FF38; 
    text-shadow:0 0 15px #C0FF38; 
    display:none; 
    pointer-events:all;
    line-height: 1.35;
    padding: 0 20px;
  }

  .game-btn {
    position: absolute;
    right: 15px;
    font-size: min(26px, 6vw);
    color: #C0FF38;
    background: rgba(0,0,0,0.5);
    padding: clamp(10px, 2.5vh, 14px) clamp(20px, 5vw, 24px);
    border-radius: 12px;
    border: 2px solid #C0FF38;
    cursor: pointer;
    pointer-events: all;
    text-shadow: 0 0 10px #C0FF38;
    z-index: 10;
    transition: all 0.15s ease;
    min-height: 48px;
    touch-action: manipulation;
  }

  .game-btn:active {
    background: rgba(192,255,56,0.25);
    transform: scale(0.96);
  }

  #restart-btn {
    top: clamp(15px, 4vh, 20px);
    display: none;
  }

  #menu-btn {
    top: calc(clamp(15px, 4vh, 20px) + 64px);
    display: none;
  }

  #footer {
    position: absolute;
    bottom: clamp(12px, 3vh, 18px);
    left: 50%;
    transform: translateX(-50%);
    font-size: min(22px, 5vw);
    color: #C0FF38;
    text-shadow: 0 0 12px #C0FF38;
    opacity: 0.9;
    pointer-events: none;
    z-index: 5;
  }

  #logo {
    position: absolute;
    top: clamp(15px, 4vh, 20px);
    left: 15px;
    width: clamp(80px, 20vw, 100px);
    height: auto;
    opacity: 0.92;
    pointer-events: none;
    filter: drop-shadow(0 0 10px #C0FF38) brightness(1.15);
    z-index: 5;
  }

  @media screen and (max-width: 430px) and (min-height: 900px) {
    #score { margin-top: 25px; font-size: 70px; }
    #wave { font-size: 28px; }
    #start { font-size: 36px; }
    #gameover { font-size: 32px; }
    .game-btn { 
      font-size: 22px; 
      padding: 12px 20px; 
    }
    #restart-btn { top: 12px; right: 12px; }
    #menu-btn { top: 72px; }
    #logo { width: 85px; top: 12px; }
    #footer { font-size: 20px; bottom: 10px; }
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui">
  <img id="logo" src="logo.png" alt="Raiku">

  <div id="score">0</div>
  <div id="wave">Wave: 1</div>
  
  <button id="restart-btn" class="game-btn">Restart</button>
  <a id="menu-btn" class="game-btn" href="index.html">Menu</a>
  
  <div id="start">Hold & Move to Play<br/><small>Desktop: Arrow Keys / WASD + Space / Click</small></div>
  <div id="gameover">
    Game Over<br/>
    <span style="font-size:clamp(20px, 4.5vw, 24px);">Score: <span id="final">0</span></span><br/>
    <span style="font-size:clamp(18px, 4vw, 20px);">Wave: <span id="finalwave">1</span></span><br/><br/>
    Tap to Play Again
  </div>

  <div id="footer">Raiku  — Solana, but guaranteed.</div>
</div>

<audio id="bgm" loop>
  <source src="bodym.mp3" type="audio/mpeg">
</audio>

<script>
// ──────────────────────────────────────────────── Setup
const canvas = document.getElementById('c');
const ctx    = canvas.getContext('2d');
const scoreEl  = document.getElementById('score');
const waveEl   = document.getElementById('wave');
const startEl  = document.getElementById('start');
const gameoverEl = document.getElementById('gameover');
const finalEl  = document.getElementById('final');
const finalWaveEl = document.getElementById('finalwave');
const restartBtn = document.getElementById('restart-btn');
const menuBtn    = document.getElementById('menu-btn');
const bgm        = document.getElementById('bgm');

let W, H;
function resize() {
  W = canvas.width  = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// Load images
const shipImg = new Image();
shipImg.src = 'dragonfire.png';
let shipImageReady = false;
shipImg.onload = () => { shipImageReady = true };

const destroyedImg = new Image();
destroyedImg.src = 'sol.png';  // ← PUT YOUR CUSTOM DESTROYED/ENEMY DEATH IMAGE HERE
let destroyedReady = false;
destroyedImg.onload = () => { destroyedReady = true };

// ──────────────────────────────────────────────── Game State
const BLACK = '#000204';
const WHITE = '#FDFDFF';
const NEON  = '#C0FF38';

let ship = { x: W/2, y: H*0.8, vx: 0, vy: 0, size: Math.min(32, W*0.08), shootCooldown: 0 };
let bullets = [];
let enemies = [];
let particles = [];
let explosions = [];   // new: for custom destroyed image effect
let score = 0;
let wave = 1;
let highScore = localStorage.getItem('raikuShooterHS') || 0;
let gameRunning = false;

const shipSpeed = 6;
const shootDelay = 12;
const bulletSpeed = 9;
const diagonalAngle = 0.7;

// ──────────────────────────────────────────────── Input
const keys = {};
let touchActive = false;
let touchX = 0, touchY = 0;

window.addEventListener('keydown', e => {
  keys[e.code] = true;
  if (e.code === 'Space' && gameRunning) shoot();
});
window.addEventListener('keyup', e => keys[e.code] = false);

window.addEventListener('click', () => {
  if (gameRunning) shoot();
});

window.addEventListener('touchstart', e => {
  e.preventDefault();
  if (!gameRunning) {
    startGame();
    return;
  }
  touchActive = true;
  updateTouchPos(e.touches[0]);
}, { passive: false });

window.addEventListener('touchmove', e => {
  e.preventDefault();
  if (gameRunning && touchActive) {
    updateTouchPos(e.touches[0]);
  }
}, { passive: false });

window.addEventListener('touchend', e => {
  e.preventDefault();
  touchActive = false;
}, { passive: false });

function updateTouchPos(touch) {
  touchX = (touch.clientX / window.innerWidth) * W;
  touchY = (touch.clientY / window.innerHeight) * H;
}

// ──────────────────────────────────────────────── Game Functions
function shoot() {
  if (!gameRunning || ship.shootCooldown > 0) return;
  bullets.push({ x: ship.x, y: ship.y - ship.size/2, vx: 0, vy: -bulletSpeed });
  bullets.push({ x: ship.x, y: ship.y - ship.size/2, vx: -bulletSpeed * Math.sin(diagonalAngle), vy: -bulletSpeed * Math.cos(diagonalAngle) });
  bullets.push({ x: ship.x, y: ship.y - ship.size/2, vx: +bulletSpeed * Math.sin(diagonalAngle), vy: -bulletSpeed * Math.cos(diagonalAngle) });
  ship.shootCooldown = shootDelay;
}

function addExplosion(x, y) {
  // Sparks / particles
  for (let i = 0; i < 20; i++) {
    particles.push({
      x, y,
      vx: (Math.random() - 0.5) * 9,
      vy: (Math.random() - 0.5) * 9,
      life: 45,
      maxLife: 45,
      size: Math.random() * 5 + 2
    });
  }

  // Custom destroyed image effect
  explosions.push({
    x, y,
    life: 32,
    maxLife: 32
  });
}

function spawnEnemy() {
  const x = 100 + Math.random() * (W - 200);
  enemies.push({ x, y: -28, vx: (Math.random() - 0.5)*1.5, vy: 3.5, size: 28, rot: 0 });
}

function nextWave() {
  wave++;
  waveEl.textContent = `Wave: ${wave}`;
  for (let i = 0; i < 5; i++) {
    setTimeout(() => { if (gameRunning) spawnEnemy(); }, i * 1000);
  }
  setTimeout(() => { if (gameRunning && enemies.length === 0) nextWave(); }, 7000);
}

// ──────────────────────────────────────────────── Update
function update() {
  if (!gameRunning) return;

  ship.vx = 0; ship.vy = 0;
  
  if (keys['ArrowLeft']  || keys['KeyA']) ship.vx = -shipSpeed;
  if (keys['ArrowRight'] || keys['KeyD']) ship.vx =  shipSpeed;
  if (keys['ArrowUp']    || keys['KeyW']) ship.vy = -shipSpeed;
  if (keys['ArrowDown']  || keys['KeyS']) ship.vy =  shipSpeed;
  
  if (touchActive) {
    const targetX = touchX;
    const targetY = Math.min(touchY, H * 0.85);
    ship.vx += (targetX - ship.x) * 0.25;
    ship.vy += (targetY - ship.y) * 0.25;
  }

  ship.x = Math.max(ship.size, Math.min(W - ship.size, ship.x + ship.vx));
  ship.y = Math.max(ship.size, Math.min(H - ship.size - 20, ship.y + ship.vy));

  ship.shootCooldown = Math.max(0, ship.shootCooldown - 1);

  if (touchActive && ship.shootCooldown === 0) {
    shoot();
  }

  bullets = bullets.filter(b => {
    b.x += b.vx; b.y += b.vy;
    return b.y > -50 && b.y < H + 50 && b.x > -50 && b.x < W + 50;
  });

  enemies.forEach(e => {
    e.rot += 0.15;
    e.x += e.vx; e.y += e.vy;
    if (e.x < -e.size) e.x = W;
    if (e.x > W + e.size) e.x = -e.size;

    const dx = ship.x - e.x, dy = ship.y - e.y;
    if (Math.sqrt(dx*dx + dy*dy) < ship.size + e.size/2) endGame();
  });
  enemies = enemies.filter(e => e.y < H + 50);

  // Collision detection + destroy with custom image
  for (let bi = bullets.length - 1; bi >= 0; bi--) {
    const b = bullets[bi];
    for (let ei = enemies.length - 1; ei >= 0; ei--) {
      const e = enemies[ei];
      if (Math.sqrt((b.x - e.x)**2 + (b.y - e.y)**2) < e.size/2 + 8) {
        addExplosion(e.x, e.y);
        bullets.splice(bi, 1);
        enemies.splice(ei, 1);
        score += 10 * wave;
        scoreEl.textContent = score;
        break;
      }
    }
  }

  particles.forEach(p => {
    p.x += p.vx; p.y += p.vy;
    p.life--;
    p.vx *= 0.98; p.vy *= 0.98;
  });
  particles = particles.filter(p => p.life > 0);

  explosions = explosions.filter(e => {
    e.life--;
    return e.life > 0;
  });

  if (enemies.length === 0) nextWave();
}

// ──────────────────────────────────────────────── Draw
function draw() {
  const grad = ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0, '#0a0f14'); grad.addColorStop(1, BLACK);
  ctx.fillStyle = grad; ctx.fillRect(0,0,W,H);

  // Stars
  ctx.fillStyle = WHITE;
  for (let i = 0; i < 100; i++) {
    const x = (i * 37) % W, y = (i * 23 + Date.now() * 0.1) % H;
    ctx.globalAlpha = 0.3 + Math.sin(Date.now() * 0.01 + i) * 0.2;
    ctx.fillRect(x, y, 2, 2);
  }
  ctx.globalAlpha = 1;

  // Enemies
  ctx.shadowColor = NEON; ctx.shadowBlur = 15; ctx.fillStyle = NEON;
  enemies.forEach(e => {
    ctx.save(); ctx.translate(e.x, e.y); ctx.rotate(e.rot);
    ctx.beginPath(); ctx.arc(0,0,e.size/2,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = BLACK;
    for (let i = 0; i < 3; i++) {
      ctx.beginPath();
      ctx.arc(Math.random()*e.size/2 - e.size/4, Math.random()*e.size/2 - e.size/4, 4, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  });
  ctx.shadowBlur = 0;

  // Bullets
  ctx.shadowColor = NEON; ctx.shadowBlur = 10; ctx.fillStyle = NEON;
  bullets.forEach(b => {
    ctx.save(); ctx.translate(b.x, b.y);
    ctx.rotate(Math.atan2(b.vy, b.vx) + Math.PI/2);
    ctx.fillRect(-2, -12, 4, 24); ctx.restore();
  });
  ctx.shadowBlur = 0;

  // Ship
  ctx.save(); ctx.translate(ship.x, ship.y);
  ctx.shadowColor = NEON; ctx.shadowBlur = 25;
  ctx.beginPath(); ctx.arc(0,0,ship.size*1.2,0,Math.PI*2);
  ctx.fillStyle = 'rgba(192,255,56,0.25)'; ctx.fill(); ctx.shadowBlur = 0;

  if (shipImageReady) {
    const imgW = ship.size * 2.2;
    const imgH = ship.size * 2.8;
    ctx.drawImage(shipImg, -imgW/2, -imgH * 0.65, imgW, imgH);
  } else {
    ctx.fillStyle = WHITE;
    ctx.beginPath();
    ctx.moveTo(0, -ship.size);
    ctx.lineTo(ship.size, ship.size * 0.6);
    ctx.lineTo(-ship.size, ship.size * 0.6);
    ctx.closePath(); ctx.fill();
  }

  ctx.fillStyle = NEON;
  ctx.beginPath();
  ctx.moveTo(-10, ship.size * 0.35);
  ctx.lineTo(0, ship.size * 0.9 + Math.sin(Date.now() * 0.03) * 5);
  ctx.lineTo(10, ship.size * 0.35);
  ctx.fill();

  ctx.restore();

  // Particles (sparks)
  ctx.shadowColor = NEON; ctx.shadowBlur = 10;
  particles.forEach(p => {
    ctx.save(); ctx.globalAlpha = p.life / p.maxLife;
    ctx.fillStyle = NEON; ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size); ctx.restore();
  });

  // Custom destroyed enemy images
  explosions.forEach(exp => {
    const progress = exp.life / exp.maxLife;
    const alpha = progress * 0.9;
    const scale = 1.0 + (1 - progress) * 0.6; // slight grow then fade

    ctx.globalAlpha = alpha;
    if (destroyedReady) {
      const sz = 64 * scale;  // adjust base size to match your image
      ctx.drawImage(destroyedImg, exp.x - sz/2, exp.y - sz/2, sz, sz);
    } else {
      // fallback
      ctx.fillStyle = NEON;
      ctx.beginPath();
      ctx.arc(exp.x, exp.y, 40 * progress, 0, Math.PI*2);
      ctx.fill();
    }
  });
  ctx.globalAlpha = 1;
  ctx.shadowBlur = 0;
}

// ──────────────────────────────────────────────── Game Loop
function render() {
  update(); draw();
  requestAnimationFrame(render);
}

// ──────────────────────────────────────────────── Start / End
function startGame() {
  if (gameRunning) return;
  gameRunning = true;
  ship.x = W/2; ship.y = H*0.8;
  bullets = []; enemies = []; particles = []; explosions = [];
  score = 0; wave = 1;
  scoreEl.textContent = '0';
  waveEl.textContent = 'Wave: 1';
  startEl.style.display = 'none';
  gameoverEl.style.display = 'none';
  restartBtn.style.display = 'block';
  menuBtn.style.display    = 'block';

  bgm.currentTime = 0;
  bgm.play().catch(()=>{});

  nextWave();
}

function endGame() {
  gameRunning = false;
  if (score > highScore) {
    highScore = score;
    localStorage.setItem('raikuShooterHS', highScore);
  }
  finalEl.textContent = score;
  finalWaveEl.textContent = wave;
  gameoverEl.innerHTML = `Game Over<br/>
    <span style="font-size:clamp(20px, 4.5vw, 24px);">Score: <span id="final">${score}</span></span><br/>
    <span style="font-size:clamp(18px, 4vw, 20px);">Wave: <span id="finalwave">${wave}</span></span><br/><br/>
    Tap to Play Again<br/><small>Best: ${highScore}</small>`;
  gameoverEl.style.display = 'block';
  restartBtn.style.display = 'none';
  menuBtn.style.display    = 'none';
  bgm.pause();
  addExplosion(ship.x, ship.y);
}

// ──────────────────────────────────────────────── Events
restartBtn.addEventListener('click', startGame);
restartBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  startGame();
});

render();

window.addEventListener('click', () => {
  if (!gameRunning) startGame();
});

window.addEventListener('touchstart', e => {
  if (!gameRunning) {
    e.preventDefault();
    startGame();
  }
});

startEl.innerHTML += `<br><small>Best: ${highScore}</small>`;
</script>
</body>
</html>